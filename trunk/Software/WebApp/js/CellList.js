function TCellList(){var l=this;var c=newElement("div","TCellList");var i="TListItem";var k="TFocusedItem";var o="TSelectedItem";var p="TMatchedString";var n;var m="";var e=-1;var r=-1;var s=null;var v=false;this.autoHide=false;this.caseSensitive=false;this.showIndex=false;this.clearTextBoxOnExit=false;this.maxDisplayedItemCount=5;this.onChanged=null;this.onHoverChanged=null;this.getElement=function(){return c};this.getSelectedIndex=function(){return e};this.getFocusedIndex=function(){return r};this.getItems=function(){return n};this.setItems=function(w,x){if(n!=w){n=w;var z="";var A=-1;if(n){A=n.length-1;if(x){for(var y=A;y>=0;y--){z+=d(A-y,n[y].toString())}}else{for(var y=0;y<=A;y++){z+=d(y,n[y].toString())}}}c.innerHTML=z;for(var y=A;y>=0;y--){z=c.childNodes[y];z.onclick=g;z.onmouseout=q;z.onmouseover=u}if(l.maxDisplayedItemCount>0){c.style.height=z.offsetHeight*l.maxDisplayedItemCount+SPixel}else{c.style.height=SAuto}}};function d(w,y){var x="";if(l.showIndex){x='<div class="TListItemIndex">'+(w+1)+"</div>"}return'<div id="'+w+'" class="TListItem">'+x+'<div class="TListItemText">'+y+"</div></div>"}this.attachTextBox=function(w){if(s!=w){if(s){s.removeEventListener(SFocus,t,false);s.removeEventListener(SKeyDown,a,false);s.removeEventListener(SKeyUp,b,false);document.addEventListener(SClick,f,false)}if(w){w.addEventListener(SFocus,t,false);w.addEventListener(SKeyDown,a,false);w.addEventListener(SKeyUp,b,false);document.addEventListener(SClick,f,false);c.style.width=w.offsetWidth-10+SPixel}s=w}};this.setMatchString=function(w){if(m!=w){m=w;l.invalidate()}};function h(x){var w=x.offsetTop-c.clientTop;if(w<c.scrollTop){c.scrollTop=w}else{w+=x.offsetHeight-c.clientHeight;if(w>c.scrollTop){c.scrollTop=w}}}this.setSelectedIndex=function(x){if(e!=x){if(e>-1){c.childNodes[e].className=i}if(x>-1){var w=c.childNodes[x];w.className=o;h(w)}e=x;if(l.onChanged){l.onChanged()}}};this.setFocusedIndex=function(x){if(r!=x){if(r>-1){var w=c.childNodes[r];if(w.id!=e){w.className=i}else{w.className=o}}if(x>-1){var w=c.childNodes[x];if(w.id!=e){w.className=k}h(w)}r=x;if(l.onHoverChanged){l.onHoverChanged()}}};this.invalidate=function(){l.setFocusedIndex(-1);var B=(m==null)||(m=="");var A='<span class="'+p+'">';var E="</span>";var z=false;var x=l.caseSensitive?"":"i";var F=new RegExp(m,x);var D;var G=0;if(l.showIndex){G=1}for(var C=c.childNodes.length-1;C>=0;C--){var H=n[C].toString();var w=c.childNodes[C];var y=w.childNodes[G];y.innerHTML=H;if(B==false){D=H.match(F);if(D){y.innerHTML=H.replace(D[0],A+D[0]+E);w.style.display=SBlock;z=true}else{w.style.display=SNone}}else{w.style.display=SBlock;z=true}}c.scrollTop=0;if(!z&&l.autoHide){c.style.visibility=SHidden}};this.focusNextItem=function(y){var w=c.childNodes;var x=-1;if(r>=0&&w[r].style.display!=SNone){x=r}if(y>0){do{x++}while((x<w.length)&&(w[x].style.display==SNone));if(x==w.length){x=-1}}else{if(x==-1){x=w.length}do{x--}while((x>-1)&&(w[x].style.display==SNone))}l.setFocusedIndex(x)};function g(w){l.setSelectedIndex(this.id);w.preventDefault()}function q(w){l.setFocusedIndex(-1);w.preventDefault()}function u(w){l.setFocusedIndex(this.id);w.preventDefault()}function t(){c.style.visibility=SVisible}function j(){if(s){if(l.clearTextBoxOnExit){s.value=""}else{if(e>-1){s.value=n[e].toString()}}}if(l.autoHide){c.style.visibility=SHidden}}function a(w){t();v=false;switch(w.keyCode){case 13:l.setSelectedIndex(r);j();break;case 38:case 40:l.focusNextItem(w.keyCode-39);if(r>-1){this.value=n[r].toString()}else{this.value=m}break;case 9:case 27:j();break;default:l.setMatchString(this.value);return}v=true}function b(w){if(!v){l.setMatchString(this.value)}}function f(w){if(w.target==s){l.setMatchString(s.value);t()}else{if(w.target==c){t()}else{j()}}}};