var cnTFlexTable="TFlexTable";var cnFocusedRow="Focused";var cnSelectedRow="Selected";var cnMatchedString="TMatchedString";var STableRow="table-row";function TFlexTable(j){var o=this;var r=newElement("table",cnTFlexTable);j.appendChild(r);var q=r.rows;var k=0;var p=0;var e;var m=-1;var n="";var c=false;var f=-1;var l=-1;var i=null;function s(w){var v=w.offsetTop-r.clientTop;if(v<r.scrollTop){r.scrollTop=v}else{v+=w.offsetHeight-r.clientHeight;if(v>r.scrollTop){r.scrollTop=v}}}this.focusNextRow=function(w){var v=-1;if((l>-1)&&(q[l].style.display!=SNone)){v=l}if(w>0){do{v++}while((v<q.length)&&(q[v].style.display==SNone));if(v==q.length){v=-1}}else{if(v==-1){v=q.length}do{v--}while((v>-1)&&(q[v].style.display==SNone))}o.setFocusedIndex(v)};function u(v){o.setSelectedIndex(this.rowIndex);v.preventDefault()}function t(v){o.setFocusedIndex(-1);v.preventDefault()}function h(v){o.setFocusedIndex(this.rowIndex);v.preventDefault()}function a(v){if(this.__readonly){return}}function g(){o.filter(-1,this.value)}function b(v){c=false;switch(v.keyCode){case 13:o.setSelectedIndex(l);break;case 38:case 40:o.focusNextRow(v.keyCode-39);if(l>-1){if(browser.isChrome||browser.isIE){this.value=q[l].cells[m].innerText}}else{this.value=n}break;case 9:case 27:if(o.autoClearTextBox){this.value="";o.filter(-1,"")}break;default:c=true}}function d(v){if(c){o.filter(-1,this.value)}}this.getColumnCount=function(){if(q.length>0){return q[0].cells.length}return 0};this.getRowCount=function(){return q.length};this.getElement=function(){return r};this.getFocusedIndex=function(){return l};this.getFocusedRow=function(){if(l>-1){return q[l]}return null};this.getSelectedIndex=function(){return f};this.getSelectedRow=function(){if(f>-1){return q[f]}return null};this.setMaxRowCount=function(w){var v=SAuto;if(w>0){v=w*q[0].offsetHeight+SPixel}r.style.maxHeight=v};this.setFocusedIndex=function(v){if(l!=v){if(l>-1){var w=q[l];if(w.rowIndex!=f){w.className=""}}if(v>-1&&v<q.length){var w=q[v];if(w.rowIndex!=f){w.className=cnFocusedRow}s(w);l=v}else{l=-1}if(o.onFocusChange){o.onFocusChange()}}};this.setSelectedIndex=function(v){if(f!=v){if((f>-1)&&(f<q.length)){q[f].className=""}if(v>-1&&v<q.length){var w=q[v];w.className=cnSelectedRow;s(w);f=v}else{f=-1}if(o.onSelectChange){o.onSelectChange()}}};this.attachTextBox=function(w,v){m=v;if(i!=w){if(i){i.removeEventListener(SFocus,g,false);i.removeEventListener(SKeyUp,d,false);i.removeEventListener(SKeyDown,b,false)}if(w){w.addEventListener(SFocus,g,false);w.addEventListener(SKeyUp,d,false);w.addEventListener(SKeyDown,b,false)}i=w}};this.filter=function(A,E,D){if(!q){return}if(A>-1){m=A}if(n!=E){n=E;o.setFocusedIndex(-1);var x=(n==null)||(n=="");var w='<span class="'+cnMatchedString+'">';var B="</span>";var v=D?"":"i";var C=new RegExp(n,v);var z;var H;var F;var G;for(var y=q.length-1;y>=0;y--){H=q[y];F=H.cells[m];G=F.innerHTML.replace(w,"").replace(B,"");F.innerHTML=G;if(x==false){z=G.match(C);if(z){F.innerHTML=G.replace(z[0],w+z[0]+B);H.style.display=STableRow}else{H.style.display=SNone}}else{H.style.display=STableRow}}r.scrollTop=0}};this.insertRow=function(v){var w=r.insertRow(v);w.onclick=u;w.onmouseout=t;w.onmouseover=h;return w};this.deleteRow=function(v){o.setFocusedIndex(-1);r.deleteRow(v);if(f>v){o.setSelectedIndex(f-1)}else{if(f==v){o.setSelectedIndex(-1)}}};this.cells=function(w,v){return r.rows[w].cells[v]};this.autoClearTextBox=true;this.onChange=null;this.onFocusChange=null;this.onSelectChange=null};